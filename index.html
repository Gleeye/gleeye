<!DOCTYPE html>
<html lang="it" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gleeye Workspace</title>
    <meta name="description" content="A premium enterprise resource planning solution for modern businesses.">
    <link rel="icon" type="image/png" href="logo_gleeye_new.png">
    <link rel="stylesheet" href="css/main.css?v=123">
    <link rel="stylesheet" href="css/design-system.css?v=123">
    <link rel="stylesheet" href="css/components/notifications.css?v=123">
    <link rel="stylesheet" href="css/components/agenda.css?v=123">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        window.addEventListener('error', function (event) {
            // Ignore benign ResizeObserver error
            if (event.message === 'ResizeObserver loop completed with undelivered notifications.') {
                event.stopImmediatePropagation();
                return;
            }

            console.error("Global Error:", event.error);
            const errDiv = document.createElement('div');
            errDiv.style.position = 'fixed';
            errDiv.style.top = '0';
            errDiv.style.left = '0';
            errDiv.style.width = '100%';
            errDiv.style.background = '#ffdddd';
            errDiv.style.color = 'red';
            errDiv.style.padding = '10px';
            errDiv.style.zIndex = '9999';
            errDiv.innerText = 'JS Error: ' + event.message;
            document.body.appendChild(errDiv);
        });
        window.addEventListener('unhandledrejection', function (event) {
            // Ignore benign ResizeObserver error
            const msg = event.reason ? (event.reason.message || event.reason) : '';
            if (msg === 'ResizeObserver loop completed with undelivered notifications.') {
                event.stopImmediatePropagation();
                return;
            }

            console.error("Unhandled Rejection:", event.reason);
            const errDiv = document.createElement('div');
            errDiv.style.position = 'fixed';
            errDiv.style.top = '30px';
            errDiv.style.left = '0';
            errDiv.style.width = '100%';
            errDiv.style.background = '#ffffdd';
            errDiv.style.color = 'orange';
            errDiv.style.padding = '10px';
            errDiv.style.zIndex = '9999';
            errDiv.innerText = 'Promise Rejection: ' + (event.reason ? event.reason.message : event.reason);
            document.body.appendChild(errDiv);
        });
    </script>
    <style>
        /* Details/Summary Tweaks */
        details>summary {
            list-style: none;
            outline: none;
        }

        details>summary::-webkit-details-marker {
            display: none;
        }

        details>summary .material-icons-round {
            transition: transform 0.3s ease;
        }

        details[open]>summary .material-icons-round {
            transform: rotate(180deg);
        }

        details[open] {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- App Shell: Auth and Modals will be injected by modules -->

    <div id="app" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <img src="logo_gleeye_new.png" alt="Gleeye" class="brand-logo">
                </div>
                <button id="sidebar-toggle" class="sidebar-toggle material-icons-round">chevron_left</button>
            </div>

            <nav class="nav-menu">
                <!-- MANAGEMENT SECTION -->
                <div id="nav-management">
                    <div class="submenu-label"
                        style="opacity: 0.5; padding: 0.5rem 1.25rem; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.05em;">
                        GESTIONALE</div>

                    <a href="#dashboard" class="nav-item active" data-target="dashboard">
                        <span class="material-icons-round">shopping_cart</span>
                        <span>Ordini</span>
                    </a>
                    <a href="#booking" class="nav-item" data-target="booking">
                        <span class="material-icons-round">event_available</span>
                        <span>Prenotazioni</span>
                    </a>

                    <div class="nav-group">
                        <div class="nav-item has-submenu" id="anagrafiche-menu-toggle">
                            <span class="material-icons-round">folder_shared</span>
                            <span>Anagrafiche</span>
                            <span class="material-icons-round expand-icon">expand_more</span>
                        </div>
                        <div class="submenu hidden" id="anagrafiche-menu-submenu">
                            <a href="#sales" class="nav-item sub-item" data-target="sales">
                                <span class="material-icons-round">business</span>
                                <span>Clienti</span>
                            </a>
                            <a href="#contacts" class="nav-item sub-item" data-target="contacts">
                                <span class="material-icons-round">contact_phone</span>
                                <span>Referenti</span>
                            </a>
                            <a href="#employees" class="nav-item sub-item" data-target="employees">
                                <span class="material-icons-round">badge</span>
                                <span>Collaboratori</span>
                            </a>
                            <a href="#assignments" class="nav-item sub-item" data-target="assignments">
                                <span class="material-icons-round">assignment_ind</span>
                                <span>Incarichi</span>
                            </a>
                            <a href="#services" class="nav-item sub-item" data-target="services">
                                <span class="material-icons-round">category</span>
                                <span>Servizi</span>
                            </a>
                            <a href="#collaborator-services" class="nav-item sub-item"
                                data-target="collaborator-services">
                                <span class="material-icons-round">assignment</span>
                                <span>Registro Servizi</span>
                            </a>
                            <a href="#suppliers" class="nav-item sub-item" data-target="suppliers">
                                <span class="material-icons-round">local_shipping</span>
                                <span>Fornitori</span>
                            </a>
                        </div>
                    </div>

                    <div class="nav-group">
                        <div class="nav-item has-submenu" id="accounting-toggle">
                            <span class="material-icons-round">account_balance</span>
                            <span>Contabilit√†</span>
                            <span class="material-icons-round expand-icon">expand_more</span>
                        </div>
                        <div class="submenu hidden" id="accounting-submenu">
                            <details open class="submenu-section" style="margin-bottom: 0.5rem;">
                                <summary class="submenu-label"
                                    style="list-style: none; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                                    Fatturato
                                    <span class="material-icons-round" style="font-size: 1rem;">expand_more</span>
                                </summary>
                                <a href="#invoices-dashboard" class="nav-item sub-item"
                                    data-target="invoices-dashboard">
                                    <span class="material-icons-round">analytics</span>
                                    <span>Dashboard Fatturato</span>
                                </a>
                                <a href="#invoices" class="nav-item sub-item" data-target="invoices">
                                    <span class="material-icons-round">receipt_long</span>
                                    <span>Fatture Attive</span>
                                </a>
                                <a href="#passive-invoices-collab" class="nav-item sub-item"
                                    data-target="passive-invoices-collab">
                                    <span class="material-icons-round">group</span>
                                    <span>Fatture Collaboratori</span>
                                </a>
                                <a href="#passive-invoices-suppliers" class="nav-item sub-item"
                                    data-target="passive-invoices-suppliers">
                                    <span class="material-icons-round">local_shipping</span>
                                    <span>Fatture Fornitori</span>
                                </a>
                                <a href="#invoices-archive" class="nav-item sub-item" data-target="invoices-archive">
                                    <span class="material-icons-round">history</span>
                                    <span>Archivio Storico</span>
                                </a>
                            </details>

                            <details class="submenu-section"
                                style="border-top: 1px solid var(--glass-border); padding-top: 0.5rem;">
                                <summary class="submenu-label"
                                    style="list-style: none; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                                    Cassa
                                    <span class="material-icons-round" style="font-size: 1rem;">expand_more</span>
                                </summary>
                                <a href="#bank-transactions" class="nav-item sub-item" data-target="bank-transactions">
                                    <span class="material-icons-round">account_balance_wallet</span>
                                    <span>Registro Movimenti</span>
                                </a>
                                <a href="#bank-statements" class="nav-item sub-item" data-target="bank-statements">
                                    <span class="material-icons-round">description</span>
                                    <span>Estratti Conto</span>
                                </a>
                                <a href="#payments" class="nav-item sub-item" data-target="payments">
                                    <span class="material-icons-round">calendar_month</span>
                                    <span>Scadenziario</span>
                                </a>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- Spacer pushes AREA PERSONALE to bottom -->
                <div style="flex: 1;"></div>

                <!-- AREA PERSONALE (Always visible) -->
                <div id="nav-personal"
                    style="padding-top: 1.5rem; margin-top: 1.5rem; border-top: 1px solid var(--glass-border);">
                    <div class="submenu-label"
                        style="opacity: 0.5; padding: 0.5rem 1.25rem; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.05em;">
                        AREA PERSONALE</div>

                    <a href="#agenda" class="nav-item" data-target="agenda">
                        <span class="material-icons-round">calendar_today</span>
                        <span>Agenda</span>
                    </a>
                    <a href="#my-assignments" class="nav-item" data-target="my-assignments">
                        <span class="material-icons-round">assignment</span>
                        <span>I miei Incarichi</span>
                    </a>
                </div>
            </nav>

            <div class="user-profile">
                <div class="avatar" id="user-avatar">??</div>
                <div class="user-info">
                    <div class="name" id="user-name">Caricamento...</div>
                    <div class="role" id="user-role">---</div>
                </div>
                <button id="logout-btn" class="icon-btn" title="Logout">
                    <span class="material-icons-round">logout</span>
                </button>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h2 id="page-title">Ordini</h2>
                <div class="actions">
                    <div class="search-bar">
                        <span class="material-icons-round">search</span>
                        <input type="text" id="global-search" placeholder="Cerca...">
                    </div>
                    <div class="header-actions">
                        <button id="theme-toggle" class="icon-btn" title="Cambia Tema">
                            <span class="material-icons-round">dark_mode</span>
                        </button>
                        <button class="icon-btn" title="Aiuto"><span
                                class="material-icons-round">help_outline</span></button>
                    </div>
                </div>
            </header>

            <div id="content-area" class="content-area">
                <div class="loading-state">
                    <span class="loader"></span>
                </div>
            </div>
        </main>
    </div>

    <!-- Main JS Module -->
    <script type="module" src="js/app.js?v=123"></script>
</body>

</html>